<section class="section-padding">
    <div class="container">
        <div id="loading-msg" style="text-align: center; color: #888;">Loading active projects...</div>
        <table id="publicProjTable" style="width: 100%; border-collapse: collapse; margin-top: 20px; display: none;">
            <thead>
                <tr style="background: #1e73be; color: white;">
                    <th style="padding: 15px; text-align: left;">Project Name</th>
                    <th style="padding: 15px; text-align: left;">Location</th>
                    <th style="padding: 15px; text-align: left;">Status</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>
</section>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Same config as your Titan ERP
    const firebaseConfig = {
        apiKey: "AIzaSyCkND2Ip7G09rELaU-S9c0LXk1ffrFSc4g",
        authDomain: "sungroup-crm.firebaseapp.com",
        projectId: "sungroup-crm",
        storageBucket: "sungroup-crm.firebasestorage.app",
        messagingSenderId: "982155471354",
        appId: "1:982155471354:web:c4b61192d247c9739edc43"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Syncing data from the "projects" collection
    const table = document.getElementById('publicProjTable');
    const tbody = table.querySelector('tbody');
    const loader = document.getElementById('loading-msg');

    onSnapshot(collection(db, "projects"), (snapshot) => {
        tbody.innerHTML = ''; // Clear existing rows
        
        if (snapshot.empty) {
            loader.innerText = "No active projects at the moment.";
            return;
        }

        snapshot.forEach((doc) => {
            const data = doc.data();
            const row = `
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 15px; font-weight: bold; color: #333;">${data.name || 'Unnamed Project'}</td>
                    <td style="padding: 15px; color: #666;">${data.loc || 'Singapore'}</td>
                    <td style="padding: 15px;">
                        <span style="background: #e1f5fe; color: #0288d1; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold;">
                            Active
                        </span>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });

        loader.style.display = 'none';
        table.style.display = 'table';
    }, (error) => {
        console.error("Error loading projects: ", error);
        loader.innerText = "Error connecting to database. Please refresh.";
    });
</script>
