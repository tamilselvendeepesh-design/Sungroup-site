<nav class="sidebar">
    <div class="brand-container"><img src="logo.png"></div>
    <button class="nav-item active" onclick="showTab('dash')"><i class="fas fa-chart-line"></i> Dashboard</button>
    <button class="nav-item" onclick="showTab('projects')"><i class="fas fa-ship"></i> Project Control</button>
    <button class="nav-item" onclick="showTab('site-logs')"><i class="fas fa-edit"></i> Daily Site Logs</button>
    <button class="nav-item" onclick="showTab('assets')"><i class="fas fa-truck-loading"></i> Heavy Assets</button>
    <button class="nav-item" onclick="showTab('docs')"><i class="fas fa-folder-open"></i> Blueprint Vault</button>
    <button class="nav-item" onclick="showTab('finance')"><i class="fas fa-file-invoice-dollar"></i> Finance</button>
    <button id="logoutBtn" class="nav-item" style="margin-top:auto; color:var(--danger);"><i class="fas fa-power-off"></i> Logout</button>
</nav>

<main class="viewport">

    <div id="tab-site-logs" class="tab-content hidden">
        <div class="card">
            <h3><i class="fas fa-hard-hat"></i> Daily Progress Report</h3>
            <div class="grid-inputs">
                <div><label>Project</label><select id="logProj" class="proj-select-list"></select></div>
                <div><label>Weather Condition</label><select id="logWeather"><option>Sunny</option><option>Rainy (Halt)</option><option>Overcast</option></select></div>
                <div><label>Manpower Count</label><input type="number" id="logStaff"></div>
            </div>
            <label>Work Progress & Issues</label>
            <textarea id="logDesc" rows="3" placeholder="Describe work done or any delays..."></textarea>
            <button onclick="saveSiteLog()" class="btn-main" style="background:var(--success)">Submit Daily Log</button>
        </div>
        <div class="card"><table id="logTable"><thead><tr><th>Date</th><th>Project</th><th>Weather</th><th>Staff</th><th>Action</th></tr></thead><tbody></tbody></table></div>
    </div>

    <div id="tab-assets" class="tab-content hidden">
        <div class="card">
            <h3><i class="fas fa-oil-can"></i> Heavy Equipment & Rentals</h3>
            <div class="grid-inputs">
                <div><label>Asset Name</label><input type="text" id="aName" placeholder="e.g. 50T Crane"></div>
                <div><label>Daily Rental Cost ($)</label><input type="number" id="aRate"></div>
                <div><label>Maintenance Due</label><input type="date" id="aMaint"></div>
                <div><label>Current Status</label><select id="aStatus"><option>On-Site</option><option>In Maintenance</option><option>Standby</option></select></div>
            </div>
            <button onclick="saveAsset()" class="btn-main">Sync Asset</button>
        </div>
        <div class="card"><table id="assetTable"><thead><tr><th>Asset</th><th>Daily Cost</th><th>Maint. Due</th><th>Status</th></tr></thead><tbody></tbody></table></div>
    </div>

    <div id="tab-docs" class="tab-content hidden">
        <div class="card">
            <h3><i class="fas fa-file-pdf"></i> Blueprint & Drawing Vault</h3>
            <div class="grid-inputs">
                <div><label>Project</label><select id="docProj" class="proj-select-list"></select></div>
                <div><label>Document Name</label><input type="text" id="docName"></div>
                <div><label>Cloud Link (Drive/Dropbox)</label><input type="text" id="docLink"></div>
            </div>
            <button onclick="saveDoc()" class="btn-main">Register Document</button>
        </div>
        <div class="card"><table id="docTable"><thead><tr><th>Project</th><th>Document</th><th>Link</th><th>Action</th></tr></thead><tbody></tbody></table></div>
    </div>

</main>

<script type="module">
    // ... (Your Existing Firebase Config) ...

    // SITE LOGS LOGIC
    window.saveSiteLog = async () => {
        const id = new Date().toISOString().split('T')[0] + "_" + document.getElementById('logProj').value;
        await setDoc(doc(db, "site_logs", id), {
            date: new Date().toLocaleDateString(),
            project: document.getElementById('logProj').value,
            weather: document.getElementById('logWeather').value,
            staff: document.getElementById('logStaff').value,
            desc: document.getElementById('logDesc').value
        });
        alert("Log Submitted!");
    };

    onSnapshot(collection(db, "site_logs"), snap => {
        const tbody = document.querySelector('#logTable tbody'); tbody.innerHTML = '';
        snap.forEach(d => {
            const l = d.data();
            tbody.innerHTML += `<tr><td>${l.date}</td><td>${l.project}</td><td>${l.weather}</td><td>${l.staff} Pax</td>
                <td><button class="btn-edit" onclick="alert('${l.desc}')">View Details</button></td></tr>`;
        });
    });

    // ASSET LOGIC
    window.saveAsset = async () => {
        const n = document.getElementById('aName').value;
        await setDoc(doc(db, "assets", n), {
            name: n, rate: document.getElementById('aRate').value,
            maint: document.getElementById('aMaint').value, status: document.getElementById('aStatus').value
        });
    };

    onSnapshot(collection(db, "assets"), snap => {
        const tbody = document.querySelector('#assetTable tbody'); tbody.innerHTML = '';
        snap.forEach(d => {
            const a = d.data();
            tbody.innerHTML += `<tr><td><b>${a.name}</b></td><td>$${a.rate}/day</td><td>${a.maint}</td>
                <td><span class="status-pill status-onsite">${a.status}</span></td></tr>`;
        });
    });

    // DOCUMENT LOGIC
    window.saveDoc = async () => {
        const n = document.getElementById('docName').value;
        await setDoc(doc(db, "documents", n), {
            project: document.getElementById('docProj').value,
            name: n, link: document.getElementById('docLink').value
        });
    };

    onSnapshot(collection(db, "documents"), snap => {
        const tbody = document.querySelector('#docTable tbody'); tbody.innerHTML = '';
        snap.forEach(d => {
            const docData = d.data();
            tbody.innerHTML += `<tr><td>${docData.project}</td><td>${docData.name}</td>
                <td><a href="${docData.link}" target="_blank" style="color:var(--primary)">Open File</a></td>
                <td><button class="btn-del" onclick="window.kill('documents','${d.id}')">X</button></td></tr>`;
        });
    });
</script>
