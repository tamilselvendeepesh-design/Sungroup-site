<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Suite | Sungroup Engineering</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        :root { --primary: #1e73be; --success: #27ae60; --danger: #e74c3c; --warning: #f39c12; --dark: #2c3e50; --light: #f4f7f9; }
        body { background: #e9ecef; font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; display: flex; }
        .hidden { display: none !important; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: var(--primary); color: white; padding: 20px; flex-shrink: 0; height: 100vh; position: sticky; top: 0; display: flex; flex-direction: column; }
        .sidebar-logo { width: 140px; margin-bottom: 30px; align-self: center; filter: brightness(0) invert(1); }
        .nav-btn { width: 100%; text-align: left; padding: 12px; margin: 4px 0; background: none; border: none; color: white; cursor: pointer; border-radius: 6px; transition: 0.2s; }
        .nav-btn:hover { background: rgba(255,255,255,0.1); }
        .nav-btn.active { background: #165a96; font-weight: bold; }

        /* Main Content */
        .main-content { flex-grow: 1; padding: 30px; max-width: 1200px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .stats-card { background: var(--primary); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        
        /* Inputs & Tables */
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-save { background: var(--success); color: white; width: 100%; }
        .btn-save:hover { opacity: 0.9; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: left; background: #f8f9fa; padding: 15px; color: var(--dark); border-bottom: 2px solid #eee; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
        .badge-high { background: #ffdada; color: #cc0000; }
        .badge-low { background: #e0f7fa; color: #006064; }

        /* Login */
        #login-box { position: fixed; inset: 0; background: #e9ecef; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .login-card { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; width: 350px; }
    </style>
</head>
<body>

    <div id="login-box">
        <div class="login-card">
            <img src="logo.png" style="width:150px; margin-bottom:20px;">
            <h3>Sungroup Admin</h3>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="pass" placeholder="Password">
            <button id="loginBtn" class="btn btn-save" style="background:var(--primary)">Login</button>
        </div>
    </div>

    <div id="dashboard" class="hidden">
        <div class="sidebar">
            <img src="logo.png" class="sidebar-logo">
            <button class="nav-btn active" onclick="showTab('projects')">ðŸ“‚ Projects</button>
            <button class="nav-btn" onclick="showTab('clients')">ðŸ‘¥ Clients</button>
            <button class="nav-btn" onclick="showTab('finance')">ðŸ’° Finance & Reports</button>
            <button id="logoutBtn" class="nav-btn" style="margin-top:auto; color:#ffcdd2;">Logout</button>
        </div>

        <div class="main-content">
            <div class="grid-3">
                <div class="stats-card">
                    <h4 style="margin:0">Active Projects</h4>
                    <h2 id="stat-active" style="margin:10px 0">0</h2>
                </div>
                <div class="stats-card" style="background:var(--success)">
                    <h4 style="margin:0">Completed</h4>
                    <h2 id="stat-done" style="margin:10px 0">0</h2>
                </div>
                <div class="stats-card" style="background:var(--warning)">
                    <h4 style="margin:0">Total Value</h4>
                    <h2 id="stat-cash" style="margin:10px 0">$0</h2>
                </div>
            </div>

            <div id="tab-projects" class="tab-content" style="margin-top:25px">
                <div class="card">
                    <h3>Project Information Center</h3>
                    <div class="grid-3">
                        <input type="text" id="pName" placeholder="Project Title">
                        <select id="pStatus">
                            <option value="In Progress">In Progress</option>
                            <option value="Testing">Testing & Comm</option>
                            <option value="Completed">Completed</option>
                        </select>
                        <select id="pPriority">
                            <option value="Normal">Priority: Normal</option>
                            <option value="High">Priority: High</option>
                            <option value="Low">Priority: Low</option>
                        </select>
                    </div>
                    <div class="grid-3">
                        <select id="pClientSelect"><option value="">-- Assign Client --</option></select>
                        <input type="date" id="pDate">
                        <input type="number" id="pVal" placeholder="Project Value ($)">
                    </div>
                    <textarea id="pDesc" rows="2" placeholder="Brief details..."></textarea>
                    <button id="saveProjBtn" class="btn btn-save">Update Project Database</button>
                </div>

                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h3>Project Registry</h3>
                        <input type="text" id="pSearch" placeholder="ðŸ” Search projects..." style="width:250px; margin:0">
                    </div>
                    <table id="projTable">
                        <thead><tr><th>Project</th><th>Client</th><th>Value</th><th>Status</th><th>Priority</th><th>Actions</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-clients" class="tab-content hidden" style="margin-top:25px">
                <div class="card">
                    <h3>Client Management</h3>
                    <div class="grid-3">
                        <input type="text" id="cCompany" placeholder="Company Name">
                        <input type="text" id="cName" placeholder="Contact Person">
                        <input type="tel" id="cPhone" placeholder="Phone">
                    </div>
                    <input type="email" id="cEmail" placeholder="Email Address">
                    <button id="saveClientBtn" class="btn btn-save" style="background:var(--primary)">Register Client</button>
                </div>
                <div class="card">
                    <table id="clientTable">
                        <thead><tr><th>Company</th><th>Contact</th><th>Phone</th><th>Email</th><th>Actions</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-finance" class="tab-content hidden" style="margin-top:25px">
                <div class="card">
                    <h3>GST Calculator & Quotation Tool</h3>
                    <div class="grid-3">
                        <input type="number" id="mat" placeholder="Material Cost ($)">
                        <input type="number" id="lab" placeholder="Labour Cost ($)">
                        <button onclick="calcGST()" class="btn btn-save" style="background:var(--warning)">Calculate</button>
                    </div>
                    <div id="res" class="hidden" style="margin-top:15px; font-size:1.1rem;">
                        Subtotal: <span id="rSub"></span> | GST: <span id="rGst"></span> | <b>Total: <span id="rTot"></span></b>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCkND2Ip7G09rELaU-S9c0LXk1ffrFSc4g",
            authDomain: "sungroup-crm.firebaseapp.com",
            projectId: "sungroup-crm",
            storageBucket: "sungroup-crm.firebasestorage.app",
            messagingSenderId: "982155471354",
            appId: "1:982155471354:web:c4b61192d247c9739edc43"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // AUTH
        onAuthStateChanged(auth, u => {
            document.getElementById('login-box').classList.toggle('hidden', !!u);
            document.getElementById('dashboard').classList.toggle('hidden', !u);
        });

        document.getElementById('loginBtn').onclick = () => {
            signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('pass').value).catch(e => alert(e.message));
        };
        document.getElementById('logoutBtn').onclick = () => signOut(auth);

        // NAVIGATION
        window.showTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+id).classList.remove('hidden');
            event.target.classList.add('active');
        };

        // REAL-TIME SYNC & STATS
        onSnapshot(collection(db, "projects"), snap => {
            const body = document.querySelector("#projTable tbody");
            body.innerHTML = '';
            let val = 0, active = 0, done = 0;
            
            snap.forEach(doc => {
                const p = doc.data();
                val += Number(p.value || 0);
                if(p.status === 'Completed') done++; else active++;

                body.innerHTML += `<tr>
                    <td><b>${p.projectName}</b></td>
                    <td>${p.clientName}</td>
                    <td>$${Number(p.value).toLocaleString()}</td>
                    <td><span class="badge" style="background:#eee">${p.status}</span></td>
                    <td><span class="badge badge-${(p.priority || 'Normal').toLowerCase()}">${p.priority || 'Normal'}</span></td>
                    <td>
                        <button class="btn" style="padding:4px 8px; background:var(--warning); color:white" onclick="editP('${p.projectName}','${p.status}','${p.priority}','${p.clientName}','${p.value}','${encodeURIComponent(p.description)}')">Edit</button>
                        <button class="btn" style="padding:4px 8px; background:var(--danger); color:white" onclick="delD('projects','${p.projectName}')">X</button>
                    </td>
                </tr>`;
            });
            document.getElementById('stat-active').innerText = active;
            document.getElementById('stat-done').innerText = done;
            document.getElementById('stat-cash').innerText = '$' + val.toLocaleString();
        });

        onSnapshot(collection(db, "clients"), snap => {
            const body = document.querySelector("#clientTable tbody");
            const drop = document.getElementById('pClientSelect');
            body.innerHTML = '';
            drop.innerHTML = '<option value="">-- Assign Client --</option>';
            
            snap.forEach(doc => {
                const c = doc.data();
                drop.innerHTML += `<option value="${c.company}">${c.company}</option>`;
                body.innerHTML += `<tr>
                    <td>${c.company}</td>
                    <td>${c.contactPerson}</td>
                    <td><a href="tel:${c.phone}">${c.phone}</a></td>
                    <td>${c.email} <button onclick="navigator.clipboard.writeText('${c.email}'); alert('Email Copied!')" style="border:none; cursor:pointer; background:none">ðŸ“‹</button></td>
                    <td><button class="btn" style="padding:4px 8px; background:var(--danger); color:white" onclick="delD('clients','${c.company}')">X</button></td>
                </tr>`;
            });
        });

        // ACTIONS
        window.delD = async (c, id) => { if(confirm('Delete?')) await deleteDoc(doc(db, c, id)); };

        window.editP = (n, s, p, c, v, d) => {
            document.getElementById('pName').value = n; document.getElementById('pStatus').value = s;
            document.getElementById('pPriority').value = p; document.getElementById('pClientSelect').value = c;
            document.getElementById('pVal').value = v; document.getElementById('pDesc').value = decodeURIComponent(d);
            showTab('projects');
        };

        document.getElementById('saveProjBtn').onclick = async () => {
            const name = document.getElementById('pName').value;
            if(!name) return alert("Enter Name");
            await setDoc(doc(db, "projects", name), {
                projectName: name, status: document.getElementById('pStatus').value,
                priority: document.getElementById('pPriority').value, clientName: document.getElementById('pClientSelect').value,
                value: document.getElementById('pVal').value, description: document.getElementById('pDesc').value,
                date: document.getElementById('pDate').value || new Date()
            });
            alert("Updated!");
        };

        document.getElementById('saveClientBtn').onclick = async () => {
            const co = document.getElementById('cCompany').value;
            if(!co) return alert("Enter Company");
            await setDoc(doc(db, "clients", co), {
                company: co, contactPerson: document.getElementById('cName').value,
                phone: document.getElementById('cPhone').value, email: document.getElementById('cEmail').value
            });
            alert("Client Saved!");
        };

        window.calcGST = () => {
            const sub = Number(document.getElementById('mat').value) + Number(document.getElementById('lab').value);
            document.getElementById('rSub').innerText = '$' + sub.toLocaleString();
            document.getElementById('rGst').innerText = '$' + (sub * 0.09).toLocaleString();
            document.getElementById('rTot').innerText = '$' + (sub * 1.09).toLocaleString();
            document.getElementById('res').classList.remove('hidden');
        };
    </script>
</body>
</html>
